<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Meme Habel">
<meta name="dcterms.date" content="2024-07-12">

<title>Code File – Meme Habel</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Meme Habel</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tableau" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tableau</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tableau">    
        <li class="dropdown-header">Makeover Monday: AirHelp Scores</li>
        <li>
    <a class="dropdown-item" href="./AirHelp_Scores.html">
 <span class="dropdown-text">Tableau</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-r" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">R</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-r">    
        <li class="dropdown-header">Global Nutrition and Health</li>
        <li>
    <a class="dropdown-item" href="./Capstone_Abstract.html">
 <span class="dropdown-text">Abstract</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Capstone_Code.html">
 <span class="dropdown-text">Code File</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Boston Housing Analysis</li>
        <li>
    <a class="dropdown-item" href="./BostonHousing_Code.html">
 <span class="dropdown-text">Boston Housing Case Study</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./BostonHousing_Presentation.html">
 <span class="dropdown-text">Presentation</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Capstone_Abstract.html">Global Nutrition and Health</a></li><li class="breadcrumb-item"><a href="./Capstone_Code.html">Code File</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Global Nutrition and Health</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Capstone_Abstract.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Abstract</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Capstone_Code.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Code File</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Boston Housing Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./BostonHousing_Code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Boston Housing Case Study</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./BostonHousing_Presentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Presentation</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#global-nutrition-and-health-analyzing-the-relationship-between-diet-composition-and-disease-prevalence" id="toc-global-nutrition-and-health-analyzing-the-relationship-between-diet-composition-and-disease-prevalence" class="nav-link active" data-scroll-target="#global-nutrition-and-health-analyzing-the-relationship-between-diet-composition-and-disease-prevalence">Global Nutrition and Health: Analyzing the Relationship Between Diet Composition and Disease Prevalence</a>
  <ul class="collapse">
  <li><a href="#preparation" id="toc-preparation" class="nav-link" data-scroll-target="#preparation">Preparation</a>
  <ul class="collapse">
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries">Load Libraries</a></li>
  <li><a href="#import-data" id="toc-import-data" class="nav-link" data-scroll-target="#import-data">Import Data</a></li>
  <li><a href="#macronutrient-composition-averages-dataset" id="toc-macronutrient-composition-averages-dataset" class="nav-link" data-scroll-target="#macronutrient-composition-averages-dataset">Macronutrient Composition Averages Dataset</a></li>
  <li><a href="#insufficient-physical-activity-averages-dataset" id="toc-insufficient-physical-activity-averages-dataset" class="nav-link" data-scroll-target="#insufficient-physical-activity-averages-dataset">Insufficient Physical Activity Averages Dataset</a></li>
  <li><a href="#average-and-reshape-alcohol-consumption-data" id="toc-average-and-reshape-alcohol-consumption-data" class="nav-link" data-scroll-target="#average-and-reshape-alcohol-consumption-data">Average and Reshape Alcohol Consumption Data</a></li>
  <li><a href="#average-gbd-data-sets" id="toc-average-gbd-data-sets" class="nav-link" data-scroll-target="#average-gbd-data-sets">Average GBD Data Sets</a></li>
  <li><a href="#combine-gbd-data" id="toc-combine-gbd-data" class="nav-link" data-scroll-target="#combine-gbd-data">Combine GBD Data</a></li>
  <li><a href="#join-datasets" id="toc-join-datasets" class="nav-link" data-scroll-target="#join-datasets">Join Datasets</a></li>
  </ul></li>
  <li><a href="#data-exploration" id="toc-data-exploration" class="nav-link" data-scroll-target="#data-exploration">Data Exploration</a>
  <ul class="collapse">
  <li><a href="#leading-disease-prevalence-in-usa" id="toc-leading-disease-prevalence-in-usa" class="nav-link" data-scroll-target="#leading-disease-prevalence-in-usa">Leading Disease Prevalence in USA</a></li>
  <li><a href="#leading-disease-death-rates-in-usa" id="toc-leading-disease-death-rates-in-usa" class="nav-link" data-scroll-target="#leading-disease-death-rates-in-usa">Leading Disease Death Rates in USA</a></li>
  </ul></li>
  <li><a href="#modeling" id="toc-modeling" class="nav-link" data-scroll-target="#modeling">Modeling</a>
  <ul class="collapse">
  <li><a href="#create-prevalence-data-set" id="toc-create-prevalence-data-set" class="nav-link" data-scroll-target="#create-prevalence-data-set">Create Prevalence Data Set</a></li>
  <li><a href="#create-dataframe-for-evaluation-metrics" id="toc-create-dataframe-for-evaluation-metrics" class="nav-link" data-scroll-target="#create-dataframe-for-evaluation-metrics">Create dataframe for evaluation metrics</a></li>
  <li><a href="#cardiovascular-diseases" id="toc-cardiovascular-diseases" class="nav-link" data-scroll-target="#cardiovascular-diseases">1. Cardiovascular Diseases</a></li>
  <li><a href="#neoplasms" id="toc-neoplasms" class="nav-link" data-scroll-target="#neoplasms">2. Neoplasms</a></li>
  <li><a href="#chronic-respiratory-diseases" id="toc-chronic-respiratory-diseases" class="nav-link" data-scroll-target="#chronic-respiratory-diseases">3. Chronic Respiratory Diseases</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Capstone_Abstract.html">Global Nutrition and Health</a></li><li class="breadcrumb-item"><a href="./Capstone_Code.html">Code File</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Code File</h1>
</div>



<div class="quarto-title-meta column-body">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Meme Habel </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 12, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="global-nutrition-and-health-analyzing-the-relationship-between-diet-composition-and-disease-prevalence" class="level1 tabset">
<h1 class="tabset">Global Nutrition and Health: Analyzing the Relationship Between Diet Composition and Disease Prevalence</h1>
<section id="preparation" class="level2">
<h2 class="anchored" data-anchor-id="preparation">Preparation</h2>
<section id="load-libraries" class="level3">
<h3 class="anchored" data-anchor-id="load-libraries">Load Libraries</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gbm)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(neuralnet)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(regclass)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pdp)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DAAG)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="import-data" class="level3">
<h3 class="anchored" data-anchor-id="import-data">Import Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load Macronutrient Composition Data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>macronutrient_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">'./data/Macronutrient Compositions_Cleaned.xlsx'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#load GBD Disease Prevalence Data</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>GBD_prevalence_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">'./data/GBD Prevalence 2010-2019.xlsx'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#load GBD Disease Deaths Data (Diseases causing deaths in each country)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>GBD_deaths_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">'./data/GBD Death 2010-2019.xlsx'</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#load GBD Disease DALYs Data (Disability-Adjusted Life Years)</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>GBD_DALY_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">'./data/GBD DALYs 2010-2019.xlsx'</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#load WHO Prevalence of insufficient physical activity among adults aged 18+ years (age-standardized estimate) (%)</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>phys_activity_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">'./data/WHO Prevalence of insufficient physical activity among adults aged 18+ years (age-standardized estimate) (percent) 2000-2019.xlsx'</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#load WHO Alcohol Consumption Data -- Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol), by beverage type</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>alc_consumption_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">'./data/Alcohol Consumption 2010-2019.xlsx'</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">#load Disease Data on specific Cardiovascular Diseases</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>cardio_specific_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">'./data/GBD Cardio Causes 2010-2019.xlsx'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(location_id,location_name,cause_id,cause_name,year), </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> measure_name, </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> val)  <span class="sc">%&gt;%</span> </span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="macronutrient-composition-averages-dataset" class="level3">
<h3 class="anchored" data-anchor-id="macronutrient-composition-averages-dataset">Macronutrient Composition Averages Dataset</h3>
<p>The Macronutrient Composition Data contains country-specific yearly diet composition values. However, the years included varies based on each country’s reporting cadence to the Food and Agriculture Organization of the United Nations. Thus, for the majority of my analysis I will be using averaged values across all included years for each country.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>avg_macronutrient_data <span class="ot">&lt;-</span> macronutrient_data <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(least_developed_country <span class="sc">==</span> <span class="st">'No'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(location_id, country) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_total_energy =</span> <span class="fu">mean</span>(total_energy, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#avg_energy_from_vegetal_products = mean(energy_from_vegetal_products, na.rm = TRUE),</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_energy_from_animal_products =</span> <span class="fu">mean</span>(energy_from_animal_products, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_total_fat =</span> <span class="fu">mean</span>(total_fat, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#avg_fat_from_vegetal_products = mean(fat_from_vegetal_products, na.rm = TRUE),</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#avg_fat_from_animal_products = mean(fat_from_animal_products, na.rm = TRUE),</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_total_protein =</span> <span class="fu">mean</span>(total_protein, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#avg_protein_from_vegetal_products = mean(protein_from_vegetal_products, na.rm = TRUE),</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">#avg_protein_from_animal_products = mean(protein_from_animal_products, na.rm = TRUE),</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_total_carbohydrates =</span> <span class="fu">mean</span>(total_carbohydrates, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'location_id'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Output as text file to use in Tableau</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(avg_macronutrient_data,<span class="st">"./data/R Output Data/avg_macronutrient_data.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Include Least Develop Countries for Tableau</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>avg_macronutrient_data_tableau <span class="ot">&lt;-</span> macronutrient_data <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(location_id, country) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_total_energy =</span> <span class="fu">mean</span>(total_energy, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#avg_energy_from_vegetal_products = mean(energy_from_vegetal_products, na.rm = TRUE),</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_energy_from_animal_products =</span> <span class="fu">mean</span>(energy_from_animal_products, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_total_fat =</span> <span class="fu">mean</span>(total_fat, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#avg_fat_from_vegetal_products = mean(fat_from_vegetal_products, na.rm = TRUE),</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#avg_fat_from_animal_products = mean(fat_from_animal_products, na.rm = TRUE),</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_total_protein =</span> <span class="fu">mean</span>(total_protein, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#avg_protein_from_vegetal_products = mean(protein_from_vegetal_products, na.rm = TRUE),</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">#avg_protein_from_animal_products = mean(protein_from_animal_products, na.rm = TRUE),</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_total_carbohydrates =</span> <span class="fu">mean</span>(total_carbohydrates, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'location_id'. You can override using the
`.groups` argument.</code></pre>
</div>
</div>
<p>Yearly with Averages</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>yearly_and_avg_macronutrient_data <span class="ot">&lt;-</span> macronutrient_data <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2000</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(avg_macronutrient_data_tableau, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">join_by</span>(location_id, country)) </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Output as text file to use in Tableau</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(yearly_and_avg_macronutrient_data,<span class="st">"./data/R Output Data/yearly_and_avg_macronutrient_data.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="insufficient-physical-activity-averages-dataset" class="level3">
<h3 class="anchored" data-anchor-id="insufficient-physical-activity-averages-dataset">Insufficient Physical Activity Averages Dataset</h3>
<p>Similar to the Macronutrient Composition data, I will primarily be working with the averages across years for the Prevalence of insufficient physical activity among adults aged 18+ years (age-standardized estimate) (%). This is defined as the “Percent of population attaining less than 150 minutes of moderate-intensity physical activity per week, or less than 75 minutes of vigorous-intensity physical activity per week, or equivalent.”. For the averages data set, I will be using data from 2010 and beyond. I will also be looking at the data for both sexes in this averaged data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>avg_phys_activity_data <span class="ot">&lt;-</span> phys_activity_data <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'ParentLocationCode'</span>, <span class="st">'ParentLocation'</span>, <span class="st">'SpatialDimValueCode'</span>, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Percent_insufficient_phys_activity low'</span>, <span class="st">'FactValueNumericHigh'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Sex <span class="sc">==</span> <span class="st">'Both sexes'</span> <span class="sc">&amp;</span> Year <span class="sc">&gt;=</span> <span class="dv">2010</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Location, location_id) <span class="sc">%&gt;%</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_pct_insufficient_activity =</span> <span class="fu">mean</span>(Percent_insufficient_phys_activity, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"keep"</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Output as text file to use in Tableau</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(avg_phys_activity_data,<span class="st">"./data/R Output Data/avg_phys_activity_data.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="average-and-reshape-alcohol-consumption-data" class="level3">
<h3 class="anchored" data-anchor-id="average-and-reshape-alcohol-consumption-data">Average and Reshape Alcohol Consumption Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>avg_alc_data <span class="ot">&lt;-</span> alc_consumption_data <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Location) <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Beverage_Type <span class="sc">!=</span> <span class="st">'Other alcoholic beverages'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Beverage_Type =</span> <span class="fu">if_else</span>(Beverage_Type <span class="sc">==</span> <span class="st">'All types'</span>, <span class="st">'Total_Alcohol'</span>, Beverage_Type)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(location_id, Beverage_Type) <span class="sc">%&gt;%</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_alc_consumption =</span> <span class="fu">mean</span>(alc_consump_per_capita, <span class="at">na.rm=</span><span class="cn">TRUE</span>, <span class="at">.groups=</span><span class="st">"keep"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> location_id, <span class="at">names_from =</span> Beverage_Type, <span class="at">values_from =</span> avg_alc_consumption) <span class="sc">%&gt;%</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">avg_total_alc_consumption =</span> Total_Alcohol) <span class="sc">%&gt;%</span> </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Beer, Wine, Spirits, Total_Alcohol))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'location_id'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Output as text file to use in Tableau</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(avg_alc_data,<span class="st">"./data/R Output Data/avg_alc_data.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="average-gbd-data-sets" class="level3">
<h3 class="anchored" data-anchor-id="average-gbd-data-sets">Average GBD Data Sets</h3>
<p>Average Disease Deaths Data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>avg_deaths_data <span class="ot">&lt;-</span> GBD_deaths_data <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(location_id, location_name, cause_id, cause_name) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_death_rate =</span> <span class="fu">mean</span>(Death_Rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'location_id', 'location_name', 'cause_id'.
You can override using the `.groups` argument.</code></pre>
</div>
</div>
<p>Average Disease Prevalence Data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>avg_prevalence_data <span class="ot">&lt;-</span> GBD_prevalence_data <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(location_id, location_name, cause_id, cause_name) <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_prevalence_rate =</span> <span class="fu">mean</span>(Prevalence_Rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'location_id', 'location_name', 'cause_id'.
You can override using the `.groups` argument.</code></pre>
</div>
</div>
<p>Average Disease DALYs Data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>avg_DALY_data <span class="ot">&lt;-</span> GBD_DALY_data <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(location_id, location_name, cause_id, cause_name) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_DALY_rate =</span> <span class="fu">mean</span>(DALY_rate, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'location_id', 'location_name', 'cause_id'.
You can override using the `.groups` argument.</code></pre>
</div>
</div>
</section>
<section id="combine-gbd-data" class="level3">
<h3 class="anchored" data-anchor-id="combine-gbd-data">Combine GBD Data</h3>
<p>Average</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>avg_GBD_combined <span class="ot">&lt;-</span> avg_prevalence_data <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(avg_deaths_data, </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">join_by</span>(location_id, location_name, cause_id, cause_name)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(avg_DALY_data, </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">join_by</span>(location_id, location_name, cause_id, cause_name))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Output as text file to use in Tableau</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(avg_GBD_combined,<span class="st">"./data/R Output Data/avg_GBD_combined.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Yearly (2010-2019)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>yearly_GBD_combined <span class="ot">&lt;-</span> GBD_prevalence_data <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(GBD_deaths_data, </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">join_by</span>(location_id, location_name, cause_id, cause_name,year)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(GBD_DALY_data, </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>             <span class="fu">join_by</span>(location_id, location_name, cause_id, cause_name,year))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Output as text file to use in Tableau</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(yearly_GBD_combined,<span class="st">"./data/R Output Data/yearly_GBD_combined.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Yearly with Averages</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>yearly_and_avg_GBD_combined <span class="ot">&lt;-</span> yearly_GBD_combined <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(avg_GBD_combined, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">join_by</span>(location_id, location_name, cause_id, cause_name)) </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Output as text file to use in Tableau</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(yearly_and_avg_GBD_combined,<span class="st">"./data/R Output Data/yearly_and_avg_GBD_combined.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="join-datasets" class="level3">
<h3 class="anchored" data-anchor-id="join-datasets">Join Datasets</h3>
<p>Next, I will join the Average Macronutrient Composition Data with the GBD Disease Prevalence Data (combined genders) as well as the Insufficient Physical Activity Averages. I will use an inner join to assure I only include country-specific data for countries included in all data sets. My primary key will be location_id.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> avg_GBD_combined <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(avg_macronutrient_data, <span class="fu">join_by</span>(location_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(avg_phys_activity_data, <span class="fu">join_by</span>(location_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(avg_alc_data, <span class="fu">join_by</span>(location_id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-exploration" class="level2">
<h2 class="anchored" data-anchor-id="data-exploration">Data Exploration</h2>
<section id="leading-disease-prevalence-in-usa" class="level3">
<h3 class="anchored" data-anchor-id="leading-disease-prevalence-in-usa">Leading Disease Prevalence in USA</h3>
<p>First, I wanted to look and see which disease categories are the most prevalent in the United States.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>USA_data_prevalence <span class="ot">&lt;-</span> avg_GBD_combined <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(location_id <span class="sc">==</span> <span class="dv">102</span>) <span class="sc">%&gt;%</span> <span class="co"># this is the location_id for USA </span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(avg_prevalence_rate, avg_death_rate, avg_DALY_rate, cause_name, cause_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by=</span>avg_prevalence_rate, <span class="at">n=</span><span class="dv">10</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>USA_data_prevalence</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   avg_prevalence_rate avg_death_rate avg_DALY_rate cause_name          cause_id
                 &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;                  &lt;dbl&gt;
 1              56716.        16.1            1375. Other non-communic…      640
 2              44417.        39.5            1570. Neurological disor…      542
 3              27161.         1.79           2736. Musculoskeletal di…      626
 4              25346.         1.22            637. Skin and subcutane…      653
 5              21431.        23.6             833. Digestive diseases       526
 6              16979.         1.94            125. HIV/AIDS and sexua…      955
 7              15993.         0.0126         2358. Mental disorders         558
 8              14862.        12.4             377. Respiratory infect…      956
 9              13908.        14.3             972. Unintentional inju…      696
10              13347.        32.5            1371. Diabetes and kidne…      974</code></pre>
</div>
</div>
</section>
<section id="leading-disease-death-rates-in-usa" class="level3">
<h3 class="anchored" data-anchor-id="leading-disease-death-rates-in-usa">Leading Disease Death Rates in USA</h3>
<p>Next, I look to see which disease categories have the highest death rates in the United States.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>USA_data_death <span class="ot">&lt;-</span> avg_GBD_combined <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(location_id <span class="sc">==</span> <span class="dv">102</span>) <span class="sc">%&gt;%</span> <span class="co"># this is the location_id for USA </span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(avg_prevalence_rate, avg_death_rate, avg_DALY_rate, cause_name, cause_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by=</span>avg_death_rate, <span class="at">n=</span><span class="dv">10</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>USA_data_death</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   avg_prevalence_rate avg_death_rate avg_DALY_rate cause_name          cause_id
                 &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt;                  &lt;dbl&gt;
 1               7612.          153.          3327. Cardiovascular dis…      491
 2               5403.          131.          3235. Neoplasms                410
 3              44417.           39.5         1570. Neurological disor…      542
 4              13009.           38.5         1353. Chronic respirator…      508
 5              13347.           32.5         1371. Diabetes and kidne…      974
 6              21431.           23.6          833. Digestive diseases       526
 7               2679.           19.0         1039. Self-harm and inte…      717
 8               5036.           16.8         1677. Substance use diso…      973
 9              56716.           16.1         1375. Other non-communic…      640
10              13908.           14.3          972. Unintentional inju…      696</code></pre>
</div>
</div>
<p>Based on the charts above, I see that Cardiovascular diseases, Neoplasms, Neurological disorders, Chronic respiratory diseases, and Diabetes and kidney diseases are the leading causes of disease-related deaths. Meanwhile ‘other non-communicable diseases’, Neurological disorders, and Musculoskeletal disorders are the most prevalent disease categories in the United States.</p>
</section>
</section>
<section id="modeling" class="level2 tabset">
<h2 class="tabset anchored" data-anchor-id="modeling">Modeling</h2>
<section id="create-prevalence-data-set" class="level3">
<h3 class="anchored" data-anchor-id="create-prevalence-data-set">Create Prevalence Data Set</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>combined_prevalence_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#select(-c(location_id, location_name, country, Location))</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(country, Location))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-dataframe-for-evaluation-metrics" class="level3">
<h3 class="anchored" data-anchor-id="create-dataframe-for-evaluation-metrics">Create dataframe for evaluation metrics</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the data frame to store evaluation metrics</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>model_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="fu">character</span>(),</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">MSPE =</span> <span class="fu">numeric</span>(),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">MAE =</span> <span class="fu">numeric</span>(),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">RMSE =</span> <span class="fu">numeric</span>(),</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">R_squared =</span> <span class="fu">numeric</span>(),</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Example function to add metrics to the data frame</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>add_model_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(model_metrics, model_name, mspe, mae, rmse, r_squared) {</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  new_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">model_name =</span> model_name,</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">MSPE =</span> mspe,</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">MAE =</span> mae,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">RMSE =</span> rmse,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">R_squared =</span> r_squared,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(model_metrics, new_metrics)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cardiovascular-diseases" class="level3 tabset">
<h3 class="tabset anchored" data-anchor-id="cardiovascular-diseases">1. Cardiovascular Diseases</h3>
<section id="cardiovascular-diseases-data-set" class="level4">
<h4 class="anchored" data-anchor-id="cardiovascular-diseases-data-set">Cardiovascular Diseases Data Set</h4>
<p>Create Cardiovascular disease prevalence data set</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cardiovascular diseases:  cause_id = 491  </span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>cardio_data <span class="ot">&lt;-</span> combined_prevalence_data <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cause_id <span class="sc">==</span> <span class="dv">491</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(cause_name, cause_id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="correlation-matrix" class="level4">
<h4 class="anchored" data-anchor-id="correlation-matrix">Correlation Matrix</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>corr_data_cardio <span class="ot">&lt;-</span> cardio_data <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(location_id, location_name)) <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(<span class="at">use =</span> <span class="st">"complete.obs"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(corr_data_cardio[<span class="dv">4</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.col =</span> <span class="st">"black"</span>, <span class="at">tl.srt =</span> <span class="dv">45</span>, <span class="at">cl.pos=</span><span class="st">'r'</span>, <span class="at">cl.ratio=</span>.<span class="dv">4</span>, <span class="at">cl.align.text=</span><span class="st">'l'</span>, <span class="at">cl.offset=</span>.<span class="dv">5</span>, <span class="at">cl.length=</span><span class="dv">15</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"Correlation Matrix for Cardiovascular Diseases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Capstone_Code_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="data-preparation-for-modeling" class="level4">
<h4 class="anchored" data-anchor-id="data-preparation-for-modeling">Data Preparation for Modeling</h4>
<p>Drop Death Rate and DALY Rate from Data Frame</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>cardio_prevalence <span class="ot">&lt;-</span> cardio_data <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(avg_death_rate, avg_DALY_rate))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Move location_id and location_name to be last columns</p>
</section>
<section id="normalize-data-and-set-cross-validation-parameters" class="level4">
<h4 class="anchored" data-anchor-id="normalize-data-and-set-cross-validation-parameters">Normalize Data and Set Cross-Validation Parameters</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Columns to move to the end</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>cols_to_move <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'location_id'</span>, <span class="st">'location_name'</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a copy of the dataset to work with</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>cardio_prevalence_scaled_strings <span class="ot">&lt;-</span> cardio_prevalence <span class="sc">%&gt;%</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">one_of</span>(cols_to_move), <span class="fu">everything</span>(), <span class="fu">one_of</span>(cols_to_move))</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Columns to exclude from scaling</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>exclude_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'location_id'</span>, <span class="st">'location_name'</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize empty vectors to store min and max values for scaling columns only</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>scaling_cols <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">colnames</span>(cardio_prevalence_scaled_strings), exclude_cols)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>min_values_cardio <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">length</span>(scaling_cols))</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>max_values_cardio <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">length</span>(scaling_cols))</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize all numerical variables to range [0, 1] and save min/max values</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_along</span>(scaling_cols)) {</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  min_val_cardio <span class="ot">&lt;-</span> <span class="fu">min</span>(cardio_prevalence_scaled_strings[[j]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  max_val_cardio <span class="ot">&lt;-</span> <span class="fu">max</span>(cardio_prevalence_scaled_strings[[j]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save min and max values</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  min_values_cardio[j] <span class="ot">&lt;-</span> min_val_cardio</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  max_values_cardio[j] <span class="ot">&lt;-</span> max_val_cardio</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalize the column</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>  cardio_prevalence_scaled_strings[[j]] <span class="ot">&lt;-</span> (cardio_prevalence_scaled_strings[[j]] <span class="sc">-</span> min_val_cardio) <span class="sc">/</span> (max_val_cardio <span class="sc">-</span> min_val_cardio)</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the cross-validation method</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>train_control_cardio <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>, <span class="at">savePredictions =</span> <span class="st">"final"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Create new data set without location_id and location_name</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>cardio_prevalence_scaled <span class="ot">&lt;-</span> cardio_prevalence_scaled_strings <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(location_id, location_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="scaled-cross-validation-linear-regression-model" class="level4">
<h4 class="anchored" data-anchor-id="scaled-cross-validation-linear-regression-model">Scaled Cross-Validation Linear Regression Model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the control for the RFE process</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>rfe_control_cardio <span class="ot">&lt;-</span> <span class="fu">rfeControl</span>(<span class="at">functions =</span> lmFuncs, <span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform RFE</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>rfe_results_cardio <span class="ot">&lt;-</span> <span class="fu">rfe</span>(cardio_prevalence_scaled[, <span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                          cardio_prevalence_scaled<span class="sc">$</span>avg_prevalence_rate, </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sizes =</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>), </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">rfeControl =</span> rfe_control_cardio)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results of RFE</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rfe_results_cardio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Recursive feature selection

Outer resampling method: Cross-Validated (10 fold) 

Resampling performance over subset size:

 Variables   RMSE Rsquared    MAE  RMSESD RsquaredSD   MAESD Selected
         2 0.2032   0.2497 0.1652 0.02766     0.2394 0.02462        *
         3 0.2071   0.2493 0.1680 0.02559     0.2520 0.02330         
         4 0.2064   0.2470 0.1662 0.02470     0.2232 0.01977         
         5 0.2071   0.2461 0.1675 0.02606     0.2312 0.02185         
         6 0.2071   0.2458 0.1676 0.02606     0.2346 0.02207         
         7 0.2071   0.2458 0.1676 0.02606     0.2346 0.02207         

The top 2 variables (out of 2):
   avg_total_alc_consumption, avg_energy_from_animal_products</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the optimal set of features</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>optimal_features_cardio <span class="ot">&lt;-</span> <span class="fu">predictors</span>(rfe_results_cardio)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(optimal_features_cardio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "avg_total_alc_consumption"       "avg_energy_from_animal_products"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model using the optimal features</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>model_cv_lm_cardio <span class="ot">&lt;-</span> <span class="fu">train</span>(avg_prevalence_rate <span class="sc">~</span> ., </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> cardio_prevalence_scaled[, <span class="fu">c</span>(optimal_features_cardio, <span class="st">"avg_prevalence_rate"</span>)], </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> train_control_cardio)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the model summary</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_cv_lm_cardio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression 

124 samples
  2 predictor

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 111, 112, 112, 110, 112, 112, ... 
Resampling results:

  RMSE       Rsquared   MAE      
  0.2037642  0.2204072  0.1654712

Tuning parameter 'intercept' was held constant at a value of TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract predictions from the model</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>predictions_cardio <span class="ot">&lt;-</span> model_cv_lm_cardio<span class="sc">$</span>pred</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate evaluation metrics</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>mspe_cv_lm_cardio <span class="ot">&lt;-</span> <span class="fu">mean</span>((predictions_cardio<span class="sc">$</span>pred <span class="sc">-</span> predictions_cardio<span class="sc">$</span>obs)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>mae_cv_lm_cardio <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(predictions_cardio<span class="sc">$</span>pred <span class="sc">-</span> predictions_cardio<span class="sc">$</span>obs))</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>rmse_cv_lm_cardio <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mspe_cv_lm_cardio)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>r_squared_cv_lm_cardio <span class="ot">&lt;-</span> <span class="fu">cor</span>(predictions_cardio<span class="sc">$</span>pred, predictions_cardio<span class="sc">$</span>obs)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the evaluation metrics</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>metrics_cv_lm_cardio <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"MSPE"</span>, <span class="st">"MAE"</span>, <span class="st">"RMSE"</span>, <span class="st">"R-squared"</span>),</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Value =</span> <span class="fu">c</span>(mspe_cv_lm_cardio, mae_cv_lm_cardio, </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>                                rmse_cv_lm_cardio, r_squared_cv_lm_cardio))</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>metrics_cv_lm_cardio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Metric      Value
1      MSPE 0.04210528
2       MAE 0.16539029
3      RMSE 0.20519571
4 R-squared 0.15942389</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the final model</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>final_model_cv_lm_cardio <span class="ot">&lt;-</span> model_cv_lm_cardio<span class="sc">$</span>finalModel</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(final_model_cv_lm_cardio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.50222 -0.13913 -0.01528  0.12836  0.56185 

Coefficients:
                                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                      0.53364    0.03930  13.580  &lt; 2e-16 ***
avg_total_alc_consumption       -0.42902    0.10007  -4.287 3.66e-05 ***
avg_energy_from_animal_products  0.04063    0.11079   0.367    0.714    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2028 on 121 degrees of freedom
Multiple R-squared:  0.1964,    Adjusted R-squared:  0.1831 
F-statistic: 14.79 on 2 and 121 DF,  p-value: 1.795e-06</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe with column names and their min/max values</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>df_min_max_cardio <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Column_Name =</span> scaling_cols,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Min_Value_cardio =</span> min_values_cardio,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Max_Value_cardio =</span> max_values_cardio,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Max_Min_cardio =</span> max_values_cardio<span class="sc">-</span>min_values_cardio</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the dataframe</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_min_max_cardio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      Column_Name Min_Value_cardio Max_Value_cardio
1             avg_prevalence_rate       4796.12490       11238.3973
2                avg_total_energy       2084.17010        3785.3803
3 avg_energy_from_animal_products         91.77625        1420.5800
4                   avg_total_fat         35.13793         168.0855
5               avg_total_protein         46.40564         135.4154
6         avg_total_carbohydrates        306.23426         591.7045
7   avg_pct_insufficient_activity          9.14600          62.6740
8       avg_total_alc_consumption          0.00000          15.1610
  Max_Min_cardio
1     6442.27245
2     1701.21021
3     1328.80380
4      132.94755
5       89.00976
6      285.47028
7       53.52800
8       15.16100</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the coefficients from the final model</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>scaled_coefficients_cv_lm_cardio <span class="ot">&lt;-</span> <span class="fu">coef</span>(final_model_cv_lm_cardio)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to convert scaled coefficients back to their original scale</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>convert_to_original_scale <span class="ot">&lt;-</span> <span class="cf">function</span>(beta_scaled, predictor, df_min_max) {</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  max_min_response <span class="ot">&lt;-</span> df_min_max_cardio<span class="sc">$</span>Max_Min[df_min_max_cardio<span class="sc">$</span>Column_Name <span class="sc">==</span> <span class="st">"avg_prevalence_rate"</span>]</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  max_min_predictor <span class="ot">&lt;-</span> df_min_max_cardio<span class="sc">$</span>Max_Min[df_min_max_cardio<span class="sc">$</span>Column_Name <span class="sc">==</span> predictor]</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  beta_original <span class="ot">&lt;-</span> beta_scaled <span class="sc">*</span> max_min_response <span class="sc">/</span> max_min_predictor</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(beta_original)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a list to store the original coefficients</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>original_coefficients_cv_lm_cardio <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each of the optimal features</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (feature <span class="cf">in</span> optimal_features_cardio) {</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (feature <span class="sc">%in%</span> <span class="fu">names</span>(scaled_coefficients_cv_lm_cardio)) {</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    beta_scaled <span class="ot">&lt;-</span> scaled_coefficients_cv_lm_cardio[[feature]]</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>    beta_original <span class="ot">&lt;-</span> <span class="fu">convert_to_original_scale</span>(beta_scaled, feature, df_min_max_cardio)</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    original_coefficients_cv_lm_cardio[[feature]] <span class="ot">&lt;-</span> beta_original</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the list to a dataframe for better readability</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>original_coefficients_df_cv_lm_cardio <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">Feature =</span> <span class="fu">names</span>(original_coefficients_cv_lm_cardio),</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">Scaled_Coefficient =</span> <span class="fu">unlist</span>(scaled_coefficients_cv_lm_cardio[optimal_features_cardio]),</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">Original_Coefficient =</span> <span class="fu">unlist</span>(original_coefficients_cv_lm_cardio)</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the dataframe with the original coefficients</span></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(original_coefficients_df_cv_lm_cardio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                        Feature
avg_total_alc_consumption             avg_total_alc_consumption
avg_energy_from_animal_products avg_energy_from_animal_products
                                Scaled_Coefficient Original_Coefficient
avg_total_alc_consumption              -0.42902431          -182.302717
avg_energy_from_animal_products         0.04063468             0.197004</code></pre>
</div>
</div>
</section>
<section id="random-forest" class="level4 tabset">
<h4 class="tabset anchored" data-anchor-id="random-forest">Random Forest</h4>
</section>
<section id="scaled-cross-validation-random-forest-model" class="level4">
<h4 class="anchored" data-anchor-id="scaled-cross-validation-random-forest-model">Scaled Cross-Validation Random Forest Model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the control for the RFE process</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>rfe_control_cardio_rf <span class="ot">&lt;-</span> <span class="fu">rfeControl</span>(<span class="at">functions =</span> rfFuncs, <span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform RFE</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>rfe_results_cardio_rf <span class="ot">&lt;-</span> <span class="fu">rfe</span>(cardio_prevalence_scaled[, <span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                          cardio_prevalence_scaled<span class="sc">$</span>avg_prevalence_rate, </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sizes =</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>), </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">rfeControl =</span> rfe_control_cardio_rf)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results of RFE</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rfe_results_cardio_rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Recursive feature selection

Outer resampling method: Cross-Validated (10 fold) 

Resampling performance over subset size:

 Variables   RMSE Rsquared    MAE  RMSESD RsquaredSD   MAESD Selected
         2 0.2034   0.2663 0.1679 0.04019     0.2133 0.03108         
         3 0.2011   0.2607 0.1651 0.04865     0.2585 0.03918         
         4 0.1957   0.3096 0.1591 0.04568     0.2805 0.03479         
         5 0.2001   0.2734 0.1615 0.04268     0.2575 0.03211         
         6 0.1927   0.2994 0.1594 0.03893     0.2363 0.02963        *
         7 0.1944   0.2835 0.1596 0.03852     0.2361 0.02852         

The top 5 variables (out of 6):
   avg_total_alc_consumption, avg_pct_insufficient_activity, avg_total_energy, avg_total_carbohydrates, avg_total_fat</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the optimal set of features</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>optimal_features_cardio_rf <span class="ot">&lt;-</span> <span class="fu">predictors</span>(rfe_results_cardio_rf)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(optimal_features_cardio_rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "avg_total_alc_consumption"       "avg_pct_insufficient_activity"  
[3] "avg_total_energy"                "avg_total_carbohydrates"        
[5] "avg_total_fat"                   "avg_energy_from_animal_products"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model using the optimal features</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>model_rf_cardio <span class="ot">&lt;-</span> <span class="fu">train</span>(avg_prevalence_rate <span class="sc">~</span> ., </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> cardio_prevalence_scaled[, <span class="fu">c</span>(optimal_features_cardio_rf, <span class="st">"avg_prevalence_rate"</span>)], </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">method =</span> <span class="st">"rf"</span>, <span class="at">trControl =</span> train_control_cardio)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the model summary</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_rf_cardio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest 

124 samples
  6 predictor

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 112, 112, 111, 112, 111, 110, ... 
Resampling results across tuning parameters:

  mtry  RMSE       Rsquared   MAE      
  2     0.1908524  0.3287765  0.1555558
  4     0.1871814  0.3622046  0.1535064
  6     0.1869256  0.3712349  0.1548544

RMSE was used to select the optimal model using the smallest value.
The final value used for the model was mtry = 6.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract predictions from the model</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>predictions_cardio_rf <span class="ot">&lt;-</span> model_rf_cardio<span class="sc">$</span>pred</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate evaluation metrics</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>mspe_rf_cardio <span class="ot">&lt;-</span> <span class="fu">mean</span>((predictions_cardio_rf<span class="sc">$</span>pred <span class="sc">-</span> predictions_cardio_rf<span class="sc">$</span>obs)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>mae_rf_cardio <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(predictions_cardio_rf<span class="sc">$</span>pred <span class="sc">-</span> predictions_cardio_rf<span class="sc">$</span>obs))</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>rmse_rf_cardio <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mspe_rf_cardio)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>r_squared_rf_cardio <span class="ot">&lt;-</span> <span class="fu">cor</span>(predictions_cardio_rf<span class="sc">$</span>pred, predictions_cardio_rf<span class="sc">$</span>obs)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the evaluation metrics</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>metrics_rf_cardio <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"MSPE"</span>, <span class="st">"MAE"</span>, <span class="st">"RMSE"</span>, <span class="st">"R-squared"</span>),</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Value =</span> <span class="fu">c</span>(mspe_rf_cardio, mae_rf_cardio, </span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>                                rmse_rf_cardio, r_squared_rf_cardio))</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>metrics_rf_cardio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Metric      Value
1      MSPE 0.03643167
2       MAE 0.15480281
3      RMSE 0.19087083
4 R-squared 0.27814731</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the final model</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>final_model_rf_cardio <span class="ot">&lt;-</span> model_rf_cardio<span class="sc">$</span>finalModel</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(final_model_rf_cardio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Length Class      Mode     
call              4    -none-     call     
type              1    -none-     character
predicted       124    -none-     numeric  
mse             500    -none-     numeric  
rsq             500    -none-     numeric  
oob.times       124    -none-     numeric  
importance        6    -none-     numeric  
importanceSD      0    -none-     NULL     
localImportance   0    -none-     NULL     
proximity         0    -none-     NULL     
ntree             1    -none-     numeric  
mtry              1    -none-     numeric  
forest           11    -none-     list     
coefs             0    -none-     NULL     
y               124    -none-     numeric  
test              0    -none-     NULL     
inbag             0    -none-     NULL     
xNames            6    -none-     character
problemType       1    -none-     character
tuneValue         1    data.frame list     
obsLevels         1    -none-     logical  
param             0    -none-     list     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(optimal_features_cardio_rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "avg_total_alc_consumption"       "avg_pct_insufficient_activity"  
[3] "avg_total_energy"                "avg_total_carbohydrates"        
[5] "avg_total_fat"                   "avg_energy_from_animal_products"</code></pre>
</div>
</div>
<p>Feature Importance</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make dataframe from importance() output</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>feat_imp_df_cardio_prevalence <span class="ot">&lt;-</span> <span class="fu">importance</span>(final_model_rf_cardio) <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">feature =</span> <span class="fu">row.names</span>(.)) </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot dataframe</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(feat_imp_df_cardio_prevalence, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(feature, IncNodePurity), </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> IncNodePurity)) <span class="sc">+</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">'identity'</span>) <span class="sc">+</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x     =</span> <span class="st">"Feature"</span>,</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">y     =</span> <span class="st">"Importance"</span>,</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Feature Importance: Cardio Random Forest Model"</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Capstone_Code_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="neoplasms" class="level3 tabset">
<h3 class="tabset anchored" data-anchor-id="neoplasms">2. Neoplasms</h3>
<section id="neoplasms-data-set" class="level4">
<h4 class="anchored" data-anchor-id="neoplasms-data-set">Neoplasms Data Set</h4>
<p>Create neoplasms prevalence data set</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Neoplasms:    cause_id = 410  </span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>neoplasm_prevalence <span class="ot">&lt;-</span> combined_prevalence_data <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cause_id <span class="sc">==</span> <span class="dv">410</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"cause_name"</span>, <span class="st">"cause_id"</span>, location_id, location_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="correlation-matrix-1" class="level4">
<h4 class="anchored" data-anchor-id="correlation-matrix-1">Correlation Matrix</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>corr_data_neoplasm <span class="ot">&lt;-</span> neoplasm_prevalence <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(<span class="at">use =</span> <span class="st">"complete.obs"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(corr_data_neoplasm[<span class="dv">4</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.col =</span> <span class="st">"black"</span>, <span class="at">tl.srt =</span> <span class="dv">45</span>, <span class="at">cl.pos=</span><span class="st">'r'</span>, <span class="at">cl.ratio=</span>.<span class="dv">4</span>, <span class="at">cl.align.text=</span><span class="st">'l'</span>, <span class="at">cl.offset=</span>.<span class="dv">5</span>, <span class="at">cl.length=</span><span class="dv">15</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"Correlation Matrix for Neoplasms"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Capstone_Code_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="data-preparation-for-modeling-1" class="level4">
<h4 class="anchored" data-anchor-id="data-preparation-for-modeling-1">Data Preparation for Modeling</h4>
<p>Drop Death Rate from Data Frame</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>neoplasm_prevalence <span class="ot">&lt;-</span> neoplasm_prevalence <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(avg_death_rate, avg_DALY_rate))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="normalize-data-and-set-cross-validation-parameters-1" class="level4">
<h4 class="anchored" data-anchor-id="normalize-data-and-set-cross-validation-parameters-1">Normalize Data and Set Cross-Validation Parameters</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a copy of the dataset to work with</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>neoplasm_prevalence_scaled <span class="ot">&lt;-</span> neoplasm_prevalence</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize empty vectors to store min and max values</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>min_values_neoplasm <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">ncol</span>(neoplasm_prevalence_scaled))</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>max_values_neoplasm <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">ncol</span>(neoplasm_prevalence_scaled))</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize all numerical variables to range [0, 1] and save min/max values</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">colnames</span>(neoplasm_prevalence_scaled)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_along</span>(cols)) {</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  min_val_neoplasm <span class="ot">&lt;-</span> <span class="fu">min</span>(neoplasm_prevalence_scaled[[j]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  max_val_neoplasm <span class="ot">&lt;-</span> <span class="fu">max</span>(neoplasm_prevalence_scaled[[j]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save min and max values</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  min_values_neoplasm[j] <span class="ot">&lt;-</span> min_val_neoplasm</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>  max_values_neoplasm[j] <span class="ot">&lt;-</span> max_val_neoplasm</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalize the column</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  neoplasm_prevalence_scaled[[j]] <span class="ot">&lt;-</span> (neoplasm_prevalence_scaled[[j]] <span class="sc">-</span> min_val_neoplasm) <span class="sc">/</span> (max_val_neoplasm <span class="sc">-</span> min_val_neoplasm)</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the cross-validation method</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>train_control_neoplasm <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>, <span class="at">savePredictions =</span> <span class="st">"final"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="scaled-cross-validation-linear-regression-model-1" class="level4">
<h4 class="anchored" data-anchor-id="scaled-cross-validation-linear-regression-model-1">Scaled Cross-Validation Linear Regression Model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the control for the RFE process</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>rfe_control_neoplasm <span class="ot">&lt;-</span> <span class="fu">rfeControl</span>(<span class="at">functions =</span> lmFuncs, <span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform RFE</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>rfe_results_neoplasm <span class="ot">&lt;-</span> <span class="fu">rfe</span>(neoplasm_prevalence_scaled[, <span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>                          neoplasm_prevalence_scaled<span class="sc">$</span>avg_prevalence_rate, </span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sizes =</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>), </span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">rfeControl =</span> rfe_control_neoplasm)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results of RFE</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rfe_results_neoplasm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Recursive feature selection

Outer resampling method: Cross-Validated (10 fold) 

Resampling performance over subset size:

 Variables   RMSE Rsquared     MAE  RMSESD RsquaredSD   MAESD Selected
         2 0.1003   0.6846 0.07796 0.03909     0.1763 0.02594        *
         3 0.1013   0.6836 0.07993 0.03842     0.1675 0.02567         
         4 0.1010   0.6859 0.07897 0.03887     0.1698 0.02556         
         5 0.1013   0.6846 0.07923 0.03896     0.1701 0.02568         
         6 0.1018   0.6815 0.07951 0.03882     0.1720 0.02551         
         7 0.1018   0.6815 0.07951 0.03882     0.1720 0.02551         

The top 2 variables (out of 2):
   avg_total_fat, avg_total_alc_consumption</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the optimal set of features</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>optimal_features_neoplasm <span class="ot">&lt;-</span> <span class="fu">predictors</span>(rfe_results_neoplasm)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(optimal_features_neoplasm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "avg_total_fat"             "avg_total_alc_consumption"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model using the optimal features</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>model_cv_lm_neoplasm <span class="ot">&lt;-</span> <span class="fu">train</span>(avg_prevalence_rate <span class="sc">~</span> ., </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> neoplasm_prevalence_scaled[, <span class="fu">c</span>(optimal_features_neoplasm, <span class="st">"avg_prevalence_rate"</span>)], </span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> train_control_neoplasm)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the model summary</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_cv_lm_neoplasm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression 

124 samples
  2 predictor

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 111, 112, 112, 110, 112, 112, ... 
Resampling results:

  RMSE       Rsquared   MAE       
  0.1041856  0.7146261  0.07861683

Tuning parameter 'intercept' was held constant at a value of TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract predictions from the model</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>predictions_neoplasm <span class="ot">&lt;-</span> model_cv_lm_neoplasm<span class="sc">$</span>pred</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate evaluation metrics</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>mspe_cv_lm_neoplasm <span class="ot">&lt;-</span> <span class="fu">mean</span>((predictions_neoplasm<span class="sc">$</span>pred <span class="sc">-</span> predictions_neoplasm<span class="sc">$</span>obs)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>mae_cv_lm_neoplasm <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(predictions_neoplasm<span class="sc">$</span>pred <span class="sc">-</span> predictions_neoplasm<span class="sc">$</span>obs))</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>rmse_cv_lm_neoplasm <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mspe_cv_lm_neoplasm)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>r_squared_cv_lm_neoplasm <span class="ot">&lt;-</span> <span class="fu">cor</span>(predictions_neoplasm<span class="sc">$</span>pred, predictions_neoplasm<span class="sc">$</span>obs)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the evaluation metrics</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>metrics_cv_lm_neoplasm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"MSPE"</span>, <span class="st">"MAE"</span>, <span class="st">"RMSE"</span>, <span class="st">"R-squared"</span>),</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Value =</span> <span class="fu">c</span>(mspe_cv_lm_neoplasm, mae_cv_lm_neoplasm, </span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>                                rmse_cv_lm_neoplasm, r_squared_cv_lm_neoplasm))</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>metrics_cv_lm_neoplasm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Metric      Value
1      MSPE 0.01163741
2       MAE 0.07862887
3      RMSE 0.10787681
4 R-squared 0.64109138</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the final model</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>final_model_cv_lm_neoplasm <span class="ot">&lt;-</span> model_cv_lm_neoplasm<span class="sc">$</span>finalModel</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(final_model_cv_lm_neoplasm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.24330 -0.05700 -0.01502  0.05251  0.47484 

Coefficients:
                          Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)               -0.03610    0.02124  -1.700   0.0917 .  
avg_total_fat              0.40552    0.04704   8.621 3.03e-14 ***
avg_total_alc_consumption  0.28772    0.04587   6.273 5.70e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1061 on 121 degrees of freedom
Multiple R-squared:  0.6612,    Adjusted R-squared:  0.6556 
F-statistic: 118.1 on 2 and 121 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe with column names and their min/max values</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>df_min_max_neoplasm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Column_Name =</span> cols,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Min_Value_neoplasm =</span> min_values_neoplasm,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Max_Value_neoplasm =</span> max_values_neoplasm,</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Max_Min_neoplasm =</span> max_values_neoplasm<span class="sc">-</span>min_values_neoplasm</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the dataframe</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_min_max_neoplasm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      Column_Name Min_Value_neoplasm Max_Value_neoplasm
1             avg_prevalence_rate          534.08993          5402.8222
2                avg_total_energy         2084.17010          3785.3803
3 avg_energy_from_animal_products           91.77625          1420.5800
4                   avg_total_fat           35.13793           168.0855
5               avg_total_protein           46.40564           135.4154
6         avg_total_carbohydrates          306.23426           591.7045
7   avg_pct_insufficient_activity            9.14600            62.6740
8       avg_total_alc_consumption            0.00000            15.1610
  Max_Min_neoplasm
1       4868.73229
2       1701.21021
3       1328.80380
4        132.94755
5         89.00976
6        285.47028
7         53.52800
8         15.16100</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the coefficients from the final model</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>scaled_coefficients_cv_lm_neoplasm <span class="ot">&lt;-</span> <span class="fu">coef</span>(final_model_cv_lm_neoplasm)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to convert scaled coefficients back to their original scale</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>convert_to_original_scale <span class="ot">&lt;-</span> <span class="cf">function</span>(beta_scaled, predictor, df_min_max) {</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  max_min_response <span class="ot">&lt;-</span> df_min_max_neoplasm<span class="sc">$</span>Max_Min[df_min_max_neoplasm<span class="sc">$</span>Column_Name <span class="sc">==</span> <span class="st">"avg_prevalence_rate"</span>]</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  max_min_predictor <span class="ot">&lt;-</span> df_min_max_neoplasm<span class="sc">$</span>Max_Min[df_min_max_neoplasm<span class="sc">$</span>Column_Name <span class="sc">==</span> predictor]</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  beta_original <span class="ot">&lt;-</span> beta_scaled <span class="sc">*</span> max_min_response <span class="sc">/</span> max_min_predictor</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(beta_original)</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a list to store the original coefficients</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>original_coefficients_cv_lm_neoplasm <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each of the optimal features</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (feature <span class="cf">in</span> optimal_features_neoplasm) {</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (feature <span class="sc">%in%</span> <span class="fu">names</span>(scaled_coefficients_cv_lm_neoplasm)) {</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>    beta_scaled <span class="ot">&lt;-</span> scaled_coefficients_cv_lm_neoplasm[[feature]]</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>    beta_original <span class="ot">&lt;-</span> <span class="fu">convert_to_original_scale</span>(beta_scaled, feature, df_min_max_neoplasm)</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>    original_coefficients_cv_lm_neoplasm[[feature]] <span class="ot">&lt;-</span> beta_original</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the list to a dataframe for better readability</span></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>original_coefficients_df_cv_lm_neoplasm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">Feature =</span> <span class="fu">names</span>(original_coefficients_cv_lm_neoplasm),</span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">Scaled_Coefficient =</span> <span class="fu">unlist</span>(scaled_coefficients_cv_lm_neoplasm[optimal_features_neoplasm]),</span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">Original_Coefficient =</span> <span class="fu">unlist</span>(original_coefficients_cv_lm_neoplasm)</span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the dataframe with the original coefficients</span></span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(original_coefficients_df_cv_lm_neoplasm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                            Feature Scaled_Coefficient
avg_total_fat                         avg_total_fat          0.4055215
avg_total_alc_consumption avg_total_alc_consumption          0.2877192
                          Original_Coefficient
avg_total_fat                         14.85078
avg_total_alc_consumption             92.39680</code></pre>
</div>
</div>
</section>
<section id="random-forest-1" class="level4 tabset">
<h4 class="tabset anchored" data-anchor-id="random-forest-1">Random Forest</h4>
</section>
<section id="scaled-cross-validation-random-forest-model-1" class="level4">
<h4 class="anchored" data-anchor-id="scaled-cross-validation-random-forest-model-1">Scaled Cross-Validation Random Forest Model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the control for the RFE process</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>rfe_control_neoplasm_rf <span class="ot">&lt;-</span> <span class="fu">rfeControl</span>(<span class="at">functions =</span> rfFuncs, <span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform RFE</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>rfe_results_neoplasm_rf <span class="ot">&lt;-</span> <span class="fu">rfe</span>(neoplasm_prevalence_scaled[, <span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>                          neoplasm_prevalence_scaled<span class="sc">$</span>avg_prevalence_rate, </span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sizes =</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>), </span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">rfeControl =</span> rfe_control_neoplasm_rf)</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results of RFE</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rfe_results_neoplasm_rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Recursive feature selection

Outer resampling method: Cross-Validated (10 fold) 

Resampling performance over subset size:

 Variables   RMSE Rsquared     MAE  RMSESD RsquaredSD   MAESD Selected
         2 0.1175   0.6009 0.08834 0.04054     0.1587 0.02192         
         3 0.1081   0.6617 0.07988 0.04055     0.1511 0.02171         
         4 0.1078   0.6665 0.08115 0.03835     0.1344 0.01975        *
         5 0.1080   0.6607 0.08215 0.03701     0.1400 0.02006         
         6 0.1085   0.6592 0.08110 0.03863     0.1445 0.02128         
         7 0.1096   0.6532 0.08250 0.03833     0.1346 0.02058         

The top 4 variables (out of 4):
   avg_total_alc_consumption, avg_energy_from_animal_products, avg_total_fat, avg_total_protein</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the optimal set of features</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>optimal_features_neoplasm_rf <span class="ot">&lt;-</span> <span class="fu">predictors</span>(rfe_results_neoplasm_rf)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(optimal_features_neoplasm_rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "avg_total_alc_consumption"       "avg_energy_from_animal_products"
[3] "avg_total_fat"                   "avg_total_protein"              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model using the optimal features</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>model_rf_neoplasm <span class="ot">&lt;-</span> <span class="fu">train</span>(avg_prevalence_rate <span class="sc">~</span> ., </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> neoplasm_prevalence_scaled[, <span class="fu">c</span>(optimal_features_neoplasm_rf, <span class="st">"avg_prevalence_rate"</span>)], </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">method =</span> <span class="st">"rf"</span>, <span class="at">trControl =</span> train_control_neoplasm)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the model summary</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_rf_neoplasm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest 

124 samples
  4 predictor

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 112, 112, 112, 112, 112, 109, ... 
Resampling results across tuning parameters:

  mtry  RMSE       Rsquared   MAE       
  2     0.1064476  0.6721951  0.07653389
  3     0.1066068  0.6734143  0.07680485
  4     0.1081302  0.6644950  0.07830742

RMSE was used to select the optimal model using the smallest value.
The final value used for the model was mtry = 2.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract predictions from the model</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>predictions_neoplasm_rf <span class="ot">&lt;-</span> model_rf_neoplasm<span class="sc">$</span>pred</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate evaluation metrics</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>mspe_rf_neoplasm <span class="ot">&lt;-</span> <span class="fu">mean</span>((predictions_neoplasm_rf<span class="sc">$</span>pred <span class="sc">-</span> predictions_neoplasm_rf<span class="sc">$</span>obs)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>mae_rf_neoplasm <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(predictions_neoplasm_rf<span class="sc">$</span>pred <span class="sc">-</span> predictions_neoplasm_rf<span class="sc">$</span>obs))</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>rmse_rf_neoplasm <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mspe_rf_neoplasm)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>r_squared_rf_neoplasm <span class="ot">&lt;-</span> <span class="fu">cor</span>(predictions_neoplasm_rf<span class="sc">$</span>pred, predictions_neoplasm_rf<span class="sc">$</span>obs)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the evaluation metrics</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>metrics_rf_neoplasm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"MSPE"</span>, <span class="st">"MAE"</span>, <span class="st">"RMSE"</span>, <span class="st">"R-squared"</span>),</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Value =</span> <span class="fu">c</span>(mspe_rf_neoplasm, mae_rf_neoplasm, </span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>                                rmse_rf_neoplasm, r_squared_rf_neoplasm))</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>metrics_rf_neoplasm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Metric      Value
1      MSPE 0.01203295
2       MAE 0.07709449
3      RMSE 0.10969481
4 R-squared 0.62868769</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the final model</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>final_model_rf_neoplasm <span class="ot">&lt;-</span> model_rf_neoplasm<span class="sc">$</span>finalModel</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(final_model_rf_neoplasm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Length Class      Mode     
call              4    -none-     call     
type              1    -none-     character
predicted       124    -none-     numeric  
mse             500    -none-     numeric  
rsq             500    -none-     numeric  
oob.times       124    -none-     numeric  
importance        4    -none-     numeric  
importanceSD      0    -none-     NULL     
localImportance   0    -none-     NULL     
proximity         0    -none-     NULL     
ntree             1    -none-     numeric  
mtry              1    -none-     numeric  
forest           11    -none-     list     
coefs             0    -none-     NULL     
y               124    -none-     numeric  
test              0    -none-     NULL     
inbag             0    -none-     NULL     
xNames            4    -none-     character
problemType       1    -none-     character
tuneValue         1    data.frame list     
obsLevels         1    -none-     logical  
param             0    -none-     list     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(optimal_features_neoplasm_rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "avg_total_alc_consumption"       "avg_energy_from_animal_products"
[3] "avg_total_fat"                   "avg_total_protein"              </code></pre>
</div>
</div>
<p>Feature Importance</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make dataframe from importance() output</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>feat_imp_df_neoplasm_prevalence <span class="ot">&lt;-</span> <span class="fu">importance</span>(final_model_rf_neoplasm) <span class="sc">%&gt;%</span> </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">feature =</span> <span class="fu">row.names</span>(.)) </span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot dataframe</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(feat_imp_df_neoplasm_prevalence, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(feature, IncNodePurity), </span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> IncNodePurity)) <span class="sc">+</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">'identity'</span>) <span class="sc">+</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x     =</span> <span class="st">"Feature"</span>,</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">y     =</span> <span class="st">"Importance"</span>,</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Feature Importance: neoplasm Random Forest Model"</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Capstone_Code_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="chronic-respiratory-diseases" class="level3 tabset">
<h3 class="tabset anchored" data-anchor-id="chronic-respiratory-diseases">3. Chronic Respiratory Diseases</h3>
<section id="chronic-respiratory-diseases-data-set" class="level4">
<h4 class="anchored" data-anchor-id="chronic-respiratory-diseases-data-set">Chronic Respiratory Diseases Data Set</h4>
<p>Create Chronic Respiratory Diseases prevalence data set</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chronic respiratory diseases: cause_id = 508  </span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>respiratory_prevalence <span class="ot">&lt;-</span> combined_prevalence_data <span class="sc">%&gt;%</span> </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cause_id <span class="sc">==</span> <span class="dv">508</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"cause_name"</span>, <span class="st">"cause_id"</span>, location_id, location_name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="correlation-matrix-2" class="level4">
<h4 class="anchored" data-anchor-id="correlation-matrix-2">Correlation Matrix</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>corr_data_respiratory <span class="ot">&lt;-</span> respiratory_prevalence <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(<span class="at">use =</span> <span class="st">"complete.obs"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(corr_data_respiratory[<span class="dv">4</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], </span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.col =</span> <span class="st">"black"</span>, <span class="at">tl.srt =</span> <span class="dv">45</span>, <span class="at">cl.pos=</span><span class="st">'r'</span>, <span class="at">cl.ratio=</span>.<span class="dv">4</span>, <span class="at">cl.align.text=</span><span class="st">'l'</span>, <span class="at">cl.offset=</span>.<span class="dv">5</span>, <span class="at">cl.length=</span><span class="dv">15</span>,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"Correlation Matrix for Chronic Respiratory Diseases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Capstone_Code_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="data-preparation-for-modeling-2" class="level4">
<h4 class="anchored" data-anchor-id="data-preparation-for-modeling-2">Data Preparation for Modeling</h4>
<p>Drop Death Rate from Data Frame</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>respiratory_prevalence <span class="ot">&lt;-</span> respiratory_prevalence <span class="sc">%&gt;%</span> </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(avg_death_rate, avg_DALY_rate))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="normalize-data-and-set-cross-validation-parameters-2" class="level4">
<h4 class="anchored" data-anchor-id="normalize-data-and-set-cross-validation-parameters-2">Normalize Data and Set Cross-Validation Parameters</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a copy of the dataset to work with</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>respiratory_prevalence_scaled <span class="ot">&lt;-</span> respiratory_prevalence</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize empty vectors to store min and max values</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>min_values_respiratory <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">ncol</span>(respiratory_prevalence_scaled))</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>max_values_respiratory <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">ncol</span>(respiratory_prevalence_scaled))</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize all numerical variables to range [0, 1] and save min/max values</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">colnames</span>(respiratory_prevalence_scaled)</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_along</span>(cols)) {</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>  min_val_respiratory <span class="ot">&lt;-</span> <span class="fu">min</span>(respiratory_prevalence_scaled[[j]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>  max_val_respiratory <span class="ot">&lt;-</span> <span class="fu">max</span>(respiratory_prevalence_scaled[[j]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save min and max values</span></span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>  min_values_respiratory[j] <span class="ot">&lt;-</span> min_val_respiratory</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>  max_values_respiratory[j] <span class="ot">&lt;-</span> max_val_respiratory</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalize the column</span></span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>  respiratory_prevalence_scaled[[j]] <span class="ot">&lt;-</span> (respiratory_prevalence_scaled[[j]] <span class="sc">-</span> min_val_respiratory) <span class="sc">/</span> (max_val_respiratory <span class="sc">-</span> min_val_respiratory)</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the cross-validation method</span></span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>train_control_respiratory <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>, <span class="at">savePredictions =</span> <span class="st">"final"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="scaled-cross-validation-linear-regression-model-2" class="level4">
<h4 class="anchored" data-anchor-id="scaled-cross-validation-linear-regression-model-2">Scaled Cross-Validation Linear Regression Model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the control for the RFE process</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>rfe_control_respiratory <span class="ot">&lt;-</span> <span class="fu">rfeControl</span>(<span class="at">functions =</span> lmFuncs, <span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform RFE</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>rfe_results_respiratory <span class="ot">&lt;-</span> <span class="fu">rfe</span>(respiratory_prevalence_scaled[, <span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>                          respiratory_prevalence_scaled<span class="sc">$</span>avg_prevalence_rate, </span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sizes =</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>), </span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">rfeControl =</span> rfe_control_respiratory)</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results of RFE</span></span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rfe_results_respiratory)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Recursive feature selection

Outer resampling method: Cross-Validated (10 fold) 

Resampling performance over subset size:

 Variables   RMSE Rsquared    MAE  RMSESD RsquaredSD   MAESD Selected
         2 0.1591   0.4078 0.1264 0.02658    0.09219 0.02037        *
         3 0.1606   0.4019 0.1303 0.02513    0.11495 0.02140         
         4 0.1614   0.3967 0.1310 0.02455    0.11772 0.02115         
         5 0.1621   0.3909 0.1315 0.02572    0.11376 0.02057         
         6 0.1631   0.3808 0.1326 0.02520    0.11017 0.02029         
         7 0.1631   0.3808 0.1326 0.02520    0.11017 0.02029         

The top 2 variables (out of 2):
   avg_energy_from_animal_products, avg_pct_insufficient_activity</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the optimal set of features</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>optimal_features_respiratory <span class="ot">&lt;-</span> <span class="fu">predictors</span>(rfe_results_respiratory)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(optimal_features_respiratory)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "avg_energy_from_animal_products" "avg_pct_insufficient_activity"  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model using the optimal features</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>model_cv_lm_respiratory <span class="ot">&lt;-</span> <span class="fu">train</span>(avg_prevalence_rate <span class="sc">~</span> ., </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> respiratory_prevalence_scaled[, <span class="fu">c</span>(optimal_features_respiratory, <span class="st">"avg_prevalence_rate"</span>)], </span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">trControl =</span> train_control_respiratory)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the model summary</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_cv_lm_respiratory)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression 

124 samples
  2 predictor

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 111, 112, 112, 110, 112, 112, ... 
Resampling results:

  RMSE      Rsquared   MAE      
  0.158675  0.4251591  0.1274361

Tuning parameter 'intercept' was held constant at a value of TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract predictions from the model</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>predictions_respiratory <span class="ot">&lt;-</span> model_cv_lm_respiratory<span class="sc">$</span>pred</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate evaluation metrics</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>mspe_cv_lm_respiratory <span class="ot">&lt;-</span> <span class="fu">mean</span>((predictions_respiratory<span class="sc">$</span>pred <span class="sc">-</span> predictions_respiratory<span class="sc">$</span>obs)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>mae_cv_lm_respiratory <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(predictions_respiratory<span class="sc">$</span>pred <span class="sc">-</span> predictions_respiratory<span class="sc">$</span>obs))</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>rmse_cv_lm_respiratory <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mspe_cv_lm_respiratory)</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>r_squared_cv_lm_respiratory <span class="ot">&lt;-</span> <span class="fu">cor</span>(predictions_respiratory<span class="sc">$</span>pred, predictions_respiratory<span class="sc">$</span>obs)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the evaluation metrics</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>metrics_cv_lm_respiratory <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"MSPE"</span>, <span class="st">"MAE"</span>, <span class="st">"RMSE"</span>, <span class="st">"R-squared"</span>),</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Value =</span> <span class="fu">c</span>(mspe_cv_lm_respiratory, mae_cv_lm_respiratory, </span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>                                rmse_cv_lm_respiratory, r_squared_cv_lm_respiratory))</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>metrics_cv_lm_respiratory</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Metric     Value
1      MSPE 0.0267144
2       MAE 0.1275765
3      RMSE 0.1634454
4 R-squared 0.3625536</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the final model</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>final_model_cv_lm_respiratory <span class="ot">&lt;-</span> model_cv_lm_respiratory<span class="sc">$</span>finalModel</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(final_model_cv_lm_respiratory)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = .outcome ~ ., data = dat)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.33485 -0.10291 -0.01406  0.08552  0.48471 

Coefficients:
                                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                     -0.007299   0.042059  -0.174    0.863    
avg_energy_from_animal_products  0.532388   0.065677   8.106 4.82e-13 ***
avg_pct_insufficient_activity    0.325999   0.069268   4.706 6.77e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1604 on 121 degrees of freedom
Multiple R-squared:  0.3996,    Adjusted R-squared:  0.3897 
F-statistic: 40.27 on 2 and 121 DF,  p-value: 3.939e-14</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe with column names and their min/max values</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>df_min_max_respiratory <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Column_Name =</span> cols,</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Min_Value_respiratory =</span> min_values_respiratory,</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Max_Value_respiratory =</span> max_values_respiratory,</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Max_Min_respiratory =</span> max_values_respiratory<span class="sc">-</span>min_values_respiratory</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the dataframe</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_min_max_respiratory)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      Column_Name Min_Value_respiratory Max_Value_respiratory
1             avg_prevalence_rate            3239.88563            13009.0378
2                avg_total_energy            2084.17010             3785.3803
3 avg_energy_from_animal_products              91.77625             1420.5800
4                   avg_total_fat              35.13793              168.0855
5               avg_total_protein              46.40564              135.4154
6         avg_total_carbohydrates             306.23426              591.7045
7   avg_pct_insufficient_activity               9.14600               62.6740
8       avg_total_alc_consumption               0.00000               15.1610
  Max_Min_respiratory
1          9769.15214
2          1701.21021
3          1328.80380
4           132.94755
5            89.00976
6           285.47028
7            53.52800
8            15.16100</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the coefficients from the final model</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>scaled_coefficients_cv_lm_respiratory <span class="ot">&lt;-</span> <span class="fu">coef</span>(final_model_cv_lm_respiratory)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to convert scaled coefficients back to their original scale</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>convert_to_original_scale <span class="ot">&lt;-</span> <span class="cf">function</span>(beta_scaled, predictor, df_min_max) {</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  max_min_response <span class="ot">&lt;-</span> df_min_max_respiratory<span class="sc">$</span>Max_Min[df_min_max_respiratory<span class="sc">$</span>Column_Name <span class="sc">==</span> <span class="st">"avg_prevalence_rate"</span>]</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>  max_min_predictor <span class="ot">&lt;-</span> df_min_max_respiratory<span class="sc">$</span>Max_Min[df_min_max_respiratory<span class="sc">$</span>Column_Name <span class="sc">==</span> predictor]</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>  beta_original <span class="ot">&lt;-</span> beta_scaled <span class="sc">*</span> max_min_response <span class="sc">/</span> max_min_predictor</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(beta_original)</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a list to store the original coefficients</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>original_coefficients_cv_lm_respiratory <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each of the optimal features</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (feature <span class="cf">in</span> optimal_features_respiratory) {</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (feature <span class="sc">%in%</span> <span class="fu">names</span>(scaled_coefficients_cv_lm_respiratory)) {</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>    beta_scaled <span class="ot">&lt;-</span> scaled_coefficients_cv_lm_respiratory[[feature]]</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>    beta_original <span class="ot">&lt;-</span> <span class="fu">convert_to_original_scale</span>(beta_scaled, feature, df_min_max_respiratory)</span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>    original_coefficients_cv_lm_respiratory[[feature]] <span class="ot">&lt;-</span> beta_original</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the list to a dataframe for better readability</span></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>original_coefficients_df_cv_lm_respiratory <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">Feature =</span> <span class="fu">names</span>(original_coefficients_cv_lm_respiratory),</span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">Scaled_Coefficient =</span> <span class="fu">unlist</span>(scaled_coefficients_cv_lm_respiratory[optimal_features_respiratory]),</span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">Original_Coefficient =</span> <span class="fu">unlist</span>(original_coefficients_cv_lm_respiratory)</span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the dataframe with the original coefficients</span></span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(original_coefficients_df_cv_lm_respiratory)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                        Feature
avg_energy_from_animal_products avg_energy_from_animal_products
avg_pct_insufficient_activity     avg_pct_insufficient_activity
                                Scaled_Coefficient Original_Coefficient
avg_energy_from_animal_products          0.5323884             3.914034
avg_pct_insufficient_activity            0.3259990            59.496601</code></pre>
</div>
</div>
</section>
<section id="random-forest-2" class="level4 tabset">
<h4 class="tabset anchored" data-anchor-id="random-forest-2">Random Forest</h4>
</section>
<section id="scaled-cross-validation-random-forest-model-2" class="level4">
<h4 class="anchored" data-anchor-id="scaled-cross-validation-random-forest-model-2">Scaled Cross-Validation Random Forest Model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the control for the RFE process</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>rfe_control_respiratory_rf <span class="ot">&lt;-</span> <span class="fu">rfeControl</span>(<span class="at">functions =</span> rfFuncs, <span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">10</span>)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform RFE</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>rfe_results_respiratory_rf <span class="ot">&lt;-</span> <span class="fu">rfe</span>(respiratory_prevalence_scaled[, <span class="sc">-</span><span class="dv">1</span>], </span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>                          respiratory_prevalence_scaled<span class="sc">$</span>avg_prevalence_rate, </span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sizes =</span> <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>), </span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">rfeControl =</span> rfe_control_respiratory_rf)</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results of RFE</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rfe_results_respiratory_rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Recursive feature selection

Outer resampling method: Cross-Validated (10 fold) 

Resampling performance over subset size:

 Variables   RMSE Rsquared    MAE  RMSESD RsquaredSD   MAESD Selected
         2 0.1596   0.4371 0.1252 0.03348     0.1789 0.02659         
         3 0.1497   0.5266 0.1189 0.03482     0.1751 0.03019        *
         4 0.1578   0.4518 0.1258 0.03553     0.1953 0.03048         
         5 0.1559   0.4632 0.1250 0.03516     0.2057 0.03023         
         6 0.1549   0.4705 0.1249 0.03614     0.2056 0.03054         
         7 0.1571   0.4511 0.1272 0.03557     0.2095 0.02936         

The top 3 variables (out of 3):
   avg_energy_from_animal_products, avg_pct_insufficient_activity, avg_total_alc_consumption</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the optimal set of features</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>optimal_features_respiratory_rf <span class="ot">&lt;-</span> <span class="fu">predictors</span>(rfe_results_respiratory_rf)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(optimal_features_respiratory_rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "avg_energy_from_animal_products" "avg_pct_insufficient_activity"  
[3] "avg_total_alc_consumption"      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model using the optimal features</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>model_rf_respiratory <span class="ot">&lt;-</span> <span class="fu">train</span>(avg_prevalence_rate <span class="sc">~</span> ., </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> respiratory_prevalence_scaled[, <span class="fu">c</span>(optimal_features_respiratory_rf, <span class="st">"avg_prevalence_rate"</span>)], </span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">method =</span> <span class="st">"rf"</span>, <span class="at">trControl =</span> train_control_respiratory)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>note: only 2 unique complexity parameters in default grid. Truncating the grid to 2 .</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the model summary</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_rf_respiratory)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest 

124 samples
  3 predictor

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 112, 111, 111, 112, 112, 112, ... 
Resampling results across tuning parameters:

  mtry  RMSE       Rsquared   MAE      
  2     0.1453625  0.4878588  0.1167705
  3     0.1447156  0.4983172  0.1167553

RMSE was used to select the optimal model using the smallest value.
The final value used for the model was mtry = 3.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract predictions from the model</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>predictions_respiratory_rf <span class="ot">&lt;-</span> model_rf_respiratory<span class="sc">$</span>pred</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate evaluation metrics</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>mspe_rf_respiratory <span class="ot">&lt;-</span> <span class="fu">mean</span>((predictions_respiratory_rf<span class="sc">$</span>pred <span class="sc">-</span> predictions_respiratory_rf<span class="sc">$</span>obs)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>mae_rf_respiratory <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(predictions_respiratory_rf<span class="sc">$</span>pred <span class="sc">-</span> predictions_respiratory_rf<span class="sc">$</span>obs))</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>rmse_rf_respiratory <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mspe_rf_respiratory)</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>r_squared_rf_respiratory <span class="ot">&lt;-</span> <span class="fu">cor</span>(predictions_respiratory_rf<span class="sc">$</span>pred, predictions_respiratory_rf<span class="sc">$</span>obs)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the evaluation metrics</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>metrics_rf_respiratory <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"MSPE"</span>, <span class="st">"MAE"</span>, <span class="st">"RMSE"</span>, <span class="st">"R-squared"</span>),</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Value =</span> <span class="fu">c</span>(mspe_rf_respiratory, mae_rf_respiratory, </span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true" tabindex="-1"></a>                                rmse_rf_respiratory, r_squared_rf_respiratory))</span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true" tabindex="-1"></a>metrics_rf_respiratory</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Metric      Value
1      MSPE 0.02184332
2       MAE 0.11671587
3      RMSE 0.14779485
4 R-squared 0.48158353</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the final model</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>final_model_rf_respiratory <span class="ot">&lt;-</span> model_rf_respiratory<span class="sc">$</span>finalModel</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(final_model_rf_respiratory)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Length Class      Mode     
call              4    -none-     call     
type              1    -none-     character
predicted       124    -none-     numeric  
mse             500    -none-     numeric  
rsq             500    -none-     numeric  
oob.times       124    -none-     numeric  
importance        3    -none-     numeric  
importanceSD      0    -none-     NULL     
localImportance   0    -none-     NULL     
proximity         0    -none-     NULL     
ntree             1    -none-     numeric  
mtry              1    -none-     numeric  
forest           11    -none-     list     
coefs             0    -none-     NULL     
y               124    -none-     numeric  
test              0    -none-     NULL     
inbag             0    -none-     NULL     
xNames            3    -none-     character
problemType       1    -none-     character
tuneValue         1    data.frame list     
obsLevels         1    -none-     logical  
param             0    -none-     list     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(optimal_features_respiratory_rf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "avg_energy_from_animal_products" "avg_pct_insufficient_activity"  
[3] "avg_total_alc_consumption"      </code></pre>
</div>
</div>
<p>Feature Importance</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make dataframe from importance() output</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>feat_imp_df_respiratory_prevalence <span class="ot">&lt;-</span> <span class="fu">importance</span>(final_model_rf_respiratory) <span class="sc">%&gt;%</span> </span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">feature =</span> <span class="fu">row.names</span>(.)) </span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot dataframe</span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(feat_imp_df_respiratory_prevalence, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(feature, IncNodePurity), </span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> IncNodePurity)) <span class="sc">+</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">'identity'</span>) <span class="sc">+</span></span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x     =</span> <span class="st">"Feature"</span>,</span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">y     =</span> <span class="st">"Importance"</span>,</span>
<span id="cb124-15"><a href="#cb124-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Feature Importance: respiratory Random Forest Model"</span></span>
<span id="cb124-16"><a href="#cb124-16" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Capstone_Code_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>